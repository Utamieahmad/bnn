DROP VIEW public.v_berantas_kasus;

CREATE OR REPLACE VIEW public.v_berantas_kasus
AS SELECT a.kasus_id,
    a.periode,
    "substring"(a.periode::text, 1, 4) AS periode_tahun,
    "substring"(a.periode::text, 5, 2) AS periode_bulan,
    a.id_instansi,
    d.nm_instansi,
    d.kd_jnsinst,
    d.id_wilayah,
    d.nm_wilayah,
    d.kd_jnswilayah,
    d.nm_jnswilayah,
    d.posisi,
    a.kasus_jenis,
    b.idxall,
    b.nm_brgbukti,
    b.kd_brgbukti,
    b.kd_jnsbrgbukti,
    c.nm_jnsbrgbukti,
    a.kasus_no,
    a.kasus_tanggal,
    a.kasus_tkp,
    a.created_by,
    a.create_date,
    a.updated_by,
    a.update_date,
    a.kasus_peran,
    e.nm_peran,
    a.kasus_kelompok,
    a.kasus_negara,
    f.country_name AS nm_kasus_negara,
        CASE
            WHEN upper(a.kasus_no::text) ~~ '%NIHIL%'::text THEN 'NIHIL'::text
            ELSE 'ADA'::text
        END AS status_input,
    ru.user_login,
    ru.user_name,
    a.meta_tersangka,
    a.meta_barangbukti_narkotika,
    a.meta_barangbukti_aset,
    a.status,
    k.nm_jnskasus,
    a.uraian_singkat,
    a.keterangan_lainnya,
    a.kasus_tkp_idprovinsi,
    a.kasus_tkp_idkabkota,
    a.nama_penyidik,
    a.modus_operandi,
    a.kode_negarasumbernarkotika,
    a.rute_asal,
    a.rute_transit,
    a.rute_tujuan,
    d.wil_id_wilayah,
    a.kategori,
    a.status_kelengkapan,
    a.meta_penyidik,
    a.tgl_kejadian,
    w1.nm_wilayah AS propinsi,
    w2.nm_wilayah AS kabupaten,
    a.jalur_masuk,
    a.deleted_at
   FROM berantas_kasus a
     LEFT JOIN tr_brgbukti b ON a.kasus_jenis = b.id_brgbukti
     LEFT JOIN tr_jnsbrgbukti c ON b.kd_jnsbrgbukti = c.kd_jnsbrgbukti
     LEFT JOIN v_instansi d ON a.id_instansi = d.id_instansi
     LEFT JOIN tr_peran e ON a.kasus_peran = e.kd_peran
     LEFT JOIN tr_countries f ON a.kasus_negara::text = f.country_code::text
     LEFT JOIN rbac_users ru ON a.created_by = ru.user_id
     LEFT JOIN tr_jnskasus k ON a.kasus_jenis = k.id
     LEFT JOIN tr_wilayah w1 ON a.kasus_tkp_idprovinsi = w1.id_wilayah
     LEFT JOIN tr_wilayah w2 ON a.kasus_tkp_idkabkota = w2.id_wilayah;


CREATE OR REPLACE VIEW public.v_berantas_pemusnahan_ladang
AS SELECT a.*,
    w2.nm_wilayah as kabupaten
   FROM berantas_narkotika_pemusnahan_ladang_ganja a
     LEFT JOIN tr_wilayah w2 on a.lokasi_idkabkota = w2.id_wilayah;


DROP VIEW public.v_berantas_tahanan_wilayah;

CREATE OR REPLACE VIEW public.v_berantas_tahanan_wilayah
AS SELECT berantas_tahanan.tahanan_id,
    berantas_tahanan.kode_jenistahanan,
    berantas_tahanan.nomor_kasus,
    berantas_tahanan.id_kasus,
    berantas_tahanan.tersangka_nama,
    berantas_tahanan.tersangka_alamat,
    berantas_tahanan.kode_jenis_kelamin,
    berantas_tahanan.tersangka_tempat_lahir,
    berantas_tahanan.tersangka_usia,
    berantas_tahanan.kode_kelompok_usia,
    berantas_tahanan.tersangka_tanggal_lahir,
    berantas_tahanan.kode_pendidikan_akhir,
    berantas_tahanan.kode_pekerjaan,
    berantas_tahanan.kode_warga_negara,
    berantas_tahanan.kode_peran_tersangka,
    berantas_tahanan.created_by,
    berantas_tahanan.create_date,
    berantas_tahanan.updated_by,
    berantas_tahanan.update_date,
    berantas_tahanan.no_identitas,
    berantas_tahanan.kode_negara,
    berantas_tahanan.kode_jenisidentitas,
    berantas_tahanan.alamatktp_idprovinsi,
    berantas_tahanan.alamatktp_idkabkota,
    berantas_tahanan.alamatktp_kodepos,
    berantas_tahanan.alamatdomisili,
    berantas_tahanan.alamatdomisili_idprovinsi,
    berantas_tahanan.alamatdomisili_idkabkota,
    berantas_tahanan.alamatdomisili_kodepos,
    berantas_tahanan.alamatlainnya,
    berantas_tahanan.alamatlainnya_idprovinsi,
    berantas_tahanan.alamatlainnya_idkabkota,
    berantas_tahanan.alamatlainnya_kodepos,
    berantas_tahanan.id_pasaldikenakan,
    berantas_tahanan.file_foto_tampak_depan,
    berantas_tahanan.file_foto_tampaksampingkanan,
    berantas_tahanan.file_foto_tampaksampingkiri,
    berantas_tahanan.file_sidikjari_kanan01,
    berantas_tahanan.file_sidikjari_kanan02,
    berantas_tahanan.file_sidikjari_kanan03,
    berantas_tahanan.file_sidikjari_kanan04,
    berantas_tahanan.file_sidikjari_kanan05,
    berantas_tahanan.file_sidikjari_kiri01,
    berantas_tahanan.file_sidikjari_kiri02,
    berantas_tahanan.file_sidikjari_kiri03,
    berantas_tahanan.file_sidikjari_kiri04,
    berantas_tahanan.file_sidikjari_kiri05,
    berantas_tahanan.fisik_warna_rambut,
    berantas_tahanan.fisik_tipikal_rambut,
    berantas_tahanan.fisik_tinggi_badan,
    berantas_tahanan.fisik_perawakan,
    berantas_tahanan.fisik_warna_kulit,
    berantas_tahanan.fisik_bentuk_mata,
    berantas_tahanan.fisik_bentuk_wajah,
    berantas_tahanan.fisik_lohat_bahasa,
    berantas_tahanan.fisik_suku_ras,
    berantas_tahanan.tgl_masuk,
    berantas_tahanan.tgl_keluar,
    berantas_tahanan.masa_berlaku_penahanan,
    berantas_tahanan.nomor_sp_penahanan,
    berantas_tahanan.asal_tahanan,
    berantas_tahanan.nama_penyidik,
    berantas_tahanan.nomor_sp_perpanjangan_penahanan_01,
    berantas_tahanan.nomor_sp_perpanjangan_penahanan_02,
    berantas_tahanan.nomor_sp_perpanjangan_penahanan_03,
    berantas_tahanan.tersangka_id,
    berantas_tahanan.header_id,
    berantas_tahanan.tersangka_nama_alias,
    berantas_tahanan.pasal_dikenakan,
    berantas_tahanan.fisik_berat_badan,
    berantas_tahanan.fisik_kelainan_mata,
    berantas_tahanan.fisik_hidung,
    berantas_tahanan.fisik_bibir,
    berantas_tahanan.fisik_gigi,
    berantas_tahanan.fisik_dagu,
    berantas_tahanan.fisik_telinga,
    berantas_tahanan.fisik_tatto,
    berantas_tahanan.fisik_cacat,
    berantas_tahanan.kode_pasal,
    tr_wilayah.posisi,
    tr_wilayah.id_wilayah,
    tr_wilayah.nm_wilayah,
    tr_jnswilayah.nm_jnswilayah,
    tr_wilayah.wil_id_wilayah,
    tr_kodenegara.nama_negara,
    berantas_tahanan.status,
    berantas_tahanan.deleted_at
   FROM berantas_tahanan
     LEFT JOIN berantas_kasus ON berantas_tahanan.id_kasus = berantas_kasus.kasus_id
     LEFT JOIN tr_instansi ON berantas_kasus.id_instansi = tr_instansi.id_instansi
     LEFT JOIN tr_wilayah ON tr_instansi.id_wilayah = tr_wilayah.id_wilayah
     LEFT JOIN tr_jnswilayah ON tr_wilayah.kd_jnswilayah = tr_jnswilayah.kd_jnswilayah
     LEFT JOIN tr_kodenegara ON tr_kodenegara.kode = berantas_tahanan.kode_negara;


DROP VIEW public.v_berantas_dpo;

CREATE OR REPLACE VIEW public.v_berantas_dpo
AS SELECT a.id,
    a.nomor_sprint_dpo,
    a.nama,
    a.alamat,
    a.kode_jenis_kelamin,
    a.tempat_lahir,
    a.usia,
    a.kode_kelompok_usia,
    a.tanggal_lahir,
    a.kode_pendidikan_akhir,
    a.kode_pekerjaan,
    a.kode_warga_negara,
    a.kode_peran_tersangka,
    a.no_identitas,
    a.kode_negara,
    a.kode_jenisidentitas,
    a.alamatktp_idprovinsi,
    a.alamatktp_idkabkota,
    a.alamatktp_kodepos,
    a.alamatdomisili,
    a.alamatdomisili_idprovinsi,
    a.alamatdomisili_idkabkota,
    a.alamatdomisili_kodepos,
    a.alamatlainnya,
    a.alamatlainnya_idprovinsi,
    a.alamatlainnya_idkabkota,
    a.alamatlainnya_kodepos,
    a.fisik_warna_rambut,
    a.fisik_tipikal_rambut,
    a.fisik_tinggi_badan,
    a.fisik_perawakan,
    a.fisik_warna_kulit,
    a.fisik_bentuk_mata,
    a.fisik_bentuk_wajah,
    a.fisik_lohat_bahasa,
    a.fisik_suku_ras,
    a.file_foto_tampak_depan,
    a.file_foto_tampak_sampingkanan,
    a.file_foto_tampak_sampingkiri,
    a.file_laporan,
    a.created_date,
    a.created_by,
    a.created_by_usernmae,
    a.updated_date,
    a.updated_by,
    a.updated_by_username,
    a.id_instansi,
    b.id_wilayah,
    b.wil_id_wilayah,
    b.nm_instansi,
    a.status,
    tr_kodenegara.nama_negara,
    a.deleted_at
   FROM berantas_dpo a
     LEFT JOIN v_instansi b ON a.id_instansi = b.id_instansi
     LEFT JOIN tr_kodenegara ON tr_kodenegara.kode::text = a.kode_negara::text;
